<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bayqaw: bayqaw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Bayqaw
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">BT-CT:0001</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">bayqaw </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Project "Bayqaw"</p>
<p>Installation <br />
You need to install ESP32 library from git: <a href="https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/mac.md">https://github.com/espressif/arduino-esp32/blob/master/docs/arduino-ide/mac.md</a></p>
<p>Then you need to install usb to UART driver <br />
<a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers</a></p>
<h2>BLE-Mesh network</h2>
<p>BLE-Mesh network is the special form of connection type where all elements of the network are nodes of the connection. Normally in the specification of the BLE-Mesh network is written that the devices that works in the mesh network have to be dual connection devices. By the other words, they got to have two BLE modules. In our case, we need to decrease cost of the project to the global minimum. As a result, we are introducing new protocol called "BPro" that was developed to satisfy limitations and purposes of the Technical Task of this research and development project. </p><h3>Protocol "BPro"</h3>
<h4>Overall</h4>
<p>BPro protocol has several differences from standard BLE-Mesh network protocol:</p><ul>
<li>It uses only one BLE module to communicate.</li>
<li>It is slower than standard protocol.</li>
<li>It can handle more devices than standard protocol. <br />
 These characteristics of the BLE-Mesh network are archived by next architectural differences:</li>
<li>BPro protocol uses each device as BLE-server and BLE-client to IO data.</li>
<li>BPro protocol uses special identification algorithm based on unique service UUID.</li>
<li>Because of asynchronous nature and strict UUID based identification it can handle huge number of devices (theoretically 16^8 devices).</li>
</ul>
<h4>Identification</h4>
<p>The identification number of the device is stored in the service UUID of each module. Normally BLE device has service UUID as next: </p><div class="fragment"><div class="line">4fafc201-1fb5-459e-8fcc-c5c9c331914b</div></div><!-- fragment --><p> These groups of bytes are used to encapsulate data as in our case. But we use it to identify priority of the devices.</p><ol type="1">
<li>Highest priority: 1XXXXXXX - Device directly connected to the Wi-Fi.</li>
<li>Lowest priority: XXXXXXX1 - Device connected to the 7th device counting from the device with highest priority.</li>
</ol>
<p>For example, there is pseudocode of the priority generation: </p><div class="fragment"><div class="line">is_wifi_connected = try_to_connect(ESSID, passwd)</div><div class="line">if is_wifi_connected == TRUE:</div><div class="line">  UUID = &quot;1&quot;.join([&quot;%s&quot; % randint(0, 9) for num in range(0, 7)])</div><div class="line">else:</div><div class="line">  highes_priority_neighbour = scan_for_other_devices(find_the_highest_priority_of_neighbours)</div><div class="line">  UUID = create_UUID_with_less_priority(highes_priority_neighbour)</div><div class="line">return UUID</div></div><!-- fragment --><p>By simple words:</p><ol type="1">
<li>If device is connected to Wi-Fi -&gt; it has highes priority</li>
<li>If device is not connected -&gt; it searches neighbour with highes priority</li>
<li>Then it creates UUID with priority 1 byte less than the priority of the highest priority neighbour</li>
<li>It means that the priority level is the distance of device to the Wi-Fi hotspot</li>
</ol>
<h4>Algorithm</h4>
<p>The next list is the steps of the connection protocol of the BLE-Mesh network of the "Bayqaw" project.</p><ol type="1">
<li>Device is turned on.</li>
<li>It starts to scan for wi-fi -&gt; if Wi-Fi is reachable go to point 5.</li>
<li>It scans neighbours with highes priority.</li>
<li>Device connects to neighbour with highest priority (parent neighbour) and creates new UUID.</li>
<li>Device does job (reads sensor values or whatever) and takes information from daughter devices - 2 minutes.</li>
<li>Device turns to client mode and starts to scan parent neighbour.</li>
<li>Device sends all data to parent neighbour, which is in server mode OR to tcp server if there is Wi-Fi.</li>
<li>Device goes to 5. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
